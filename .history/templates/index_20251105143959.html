<!doctype html>
<html>
<head>
  <meta charset="utf-8">
  <title>üé• HLS Stream Converter</title>
  <script>
    async function convert() {
      const src = document.getElementById("source").value.trim();
      if (!src) return alert("Masukkan URL terlebih dahulu!");
      const res = await fetch("/convert", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ source: src })
      });
      const data = await res.json();
      if (data.player_url) {
        // tambahkan langsung ke tabel tanpa reload
        addStreamRow(data.id, src, data.player_url);
      } else {
        alert("Gagal convert: " + (data.error || "Unknown error"));
      }
    }

    function addStreamRow(id, src, playerUrl) {
      const table = document.getElementById("streamTable");
      const row = document.createElement("tr");
      row.innerHTML = `
        <td>${id}</td>
        <td style="word-break:break-all;">${src}</td>
        <td>${new Date().toLocaleString()}</td>
        <td><a href="${playerUrl}" target="_blank" class="btn">‚ñ∂Ô∏è Tonton</a></td>
      `;
      table.appendChild(row);
    }
  </script>
  <style>
    body { font-family: Arial; margin:40px; background:#fafafa; }
    input { width:70%; padding:8px; font-size:16px; }
    button { padding:8px 16px; font-size:16px; margin-left:6px; }
    table { width:100%; border-collapse:collapse; margin-top:20px; }
    th, td { border:1px solid #ccc; padding:8px; text-align:left; }
    th { background:#eee; }
    a.btn {
      background:#007bff; color:#fff; padding:6px 12px; text-decoration:none;
      border-radius:5px; font-weight:bold; transition:0.2s;
    }
    a.btn:hover { background:#0056b3; }
  </style>
</head>
<body>
  <h2>üé• HLS Stream Converter</h2>

  <input id="source" placeholder="Masukkan URL video streaming...">
  <button onclick="convert()">Convert</button>

  <h3>Daftar Stream Aktif</h3>
  <table>
    <thead>
      <tr><th>ID</th><th>Sumber</th><th>Mulai</th><th>Link</th></tr>
    </thead>
    <tbody id="streamTable">
      {% for s in streams %}
      <tr>
        <td>{{ s.id }}</td>
        <td style="word-break:break-all;">{{ s.source }}</td>
        <td>{{ s.started }}</td>
        <td><a href="{{ s.url }}" target="_blank" class="btn">‚ñ∂Ô∏è Tonton</a></td>
      </tr>
      {% endfor %}
    </tbody>
  </table>
</body>
</html>
